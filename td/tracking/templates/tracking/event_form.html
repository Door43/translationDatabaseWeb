{% extends "site_base.html" %}


{% load i18n %}
{% load bootstrap %}

{% block head_title %}Translation Project Event | New{% endblock head_title %}

{% block extra_style %}
	<style>
		form .form-group::after {
			content: '';
			display: block;
			clear: both;
		}
		.date-input {
			width: calc(33.33% - 3px);
			display: inline-block;
			float: left;
			margin-right: 3px;
		}
		.date-input:last-child {
			width: 33.33%;
			margin-right: 0;
		}
		.inline div, .inline label {
			display: inline;
			float: left;
		}
		.half-width {
			width: 50%;
		}
		.quarter-width {
			width: 25%;
		}
		.inline input[type="checkbox"].form-control {
			width: 20px;
			height: 20px;
			margin: 7px auto 0 auto;
		}
		.facilitator-text {
			width: 67.5%;
		}
		.facilitator-checkboxes {
			width: 32.5%;
		}
	</style>
{% endblock extra_style %}	

{% block body %}

	<div class="row">
		<div class="col-md-6">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h2 class="panel-title">New Translation Workshop/Event</h2>
					{{form.errors}}
				</div>
				<div class="panel-body">
					<form action="{% url 'tracking:event_add' %}" method="POST" class="form">
						{% csrf_token %}
						{{ form.created_by | bootstrap }}
						{{ form.lead_dept | bootstrap }}
						{{ form.charter | bootstrap }}
						{{ form.start_date | bootstrap }}
						{{ form.end_date | bootstrap }}
						{{ form.location | bootstrap }}
						{{ form.networks | bootstrap }}

						<div class="form-group clearfix">
							<div class="inline inline-label">
								<div class="facilitator-text">
									<label class="control-label">Facilitator</label>
									<a id="add-facilitator" class="btn btn-default btn-xs" href="" style="margin-left: 1rem;">
										<i class="fa fa-plus"></i>
									</a>
								</div>
								<div class="facilitator-checkboxes">
									<label class="control-label half-width text-center">Lead</label>
									<label class="control-label half-width text-center">Speaks GL</label>
								</div>
							</div>
							<div id="facilitator-list">
								{% for facilitator in facilitators %}
									<div class="inline inline-input clearfix">
										<div class="facilitator-text clearfix">
										<input name="facilitator{{ forloop.counter0 }}" type="text" class="form-control" value="{{ facilitator.name }}"/>
									</div>
									<div class="facilitator-checkboxes">
										<div class="half-width"><input name="is_lead{{ forloop.counter0 }}" type="checkbox" class="form-control" {% if facilitator.is_lead %}checked{% endif %} /></div>
										<div class="half-width"><input name="speaks_gl{{ forloop.counter0 }}" type="checkbox" class="form-control"  {% if facilitator.speaks_gl %}checked{% endif %} /></div>
									</div>
								</div>
								{% endfor %}
							</div>
						</div>
						{{ form.contact_person | bootstrap }}
						<!-- {{ form | bootstrap }} -->
						<button type="submit" class="btn btn-primary pull-right">
							{% if form.errors %}
								Try again
							{% else %}
								Add Event
							{% endif %}
						</button>

						<input type="hidden" name="facilitator-count" value="0" />
					</form>
				</div>
			</div>
		</div>
	</div>

{% endblock body%}

{% block custom_bottom_script %}
<script>

	document.addEventListener('DOMContentLoaded', function (event) {
		// Initial rows
		if (!$('[name="facilitator0"]').length)
			addInline('facilitator');

		// Attach listeners
		var facilitator_button = document.querySelector('#add-facilitator');
		facilitator_button.addEventListener('click', function(event) {
			event.preventDefault();
			addInline('facilitator');
		});
	});

	function addInline(label) {
		var list = $('#' + label + '-list');
		var length = list.children().length;
		var elem = '';
		switch(label) {
			case 'facilitator':
				elem = '<div class="inline inline-input clearfix">' +
					'<div class="facilitator-text clearfix">' +
						'<input name="facilitator' + length + '" type="text" class="form-control" />' +
					'</div>' +
					'<div class="facilitator-checkboxes">' +
						'<div class="half-width"><input name="is_lead' + length + '" type="checkbox" class="form-control" /></div>' +
						'<div class="half-width"><input name="speaks_gl' + length + '" type="checkbox" class="form-control" /></div>' +
					'</div>' +
				'</div>';
				break;
			case 'translator':
				console.log('label is', label);
				break;
			case 'material':
				console.log('label is', label);
				break;
			default:
				console.log('switch default');
				break;
		}
		list.append(elem);
		addCount(label);
	}

	function addCount(label) {
		var elem = document.getElementsByName(label + '-count');
		elem[0].value = parseInt(elem[0].value) + 1;
	}
</script>
{% endblock custom_bottom_script %}